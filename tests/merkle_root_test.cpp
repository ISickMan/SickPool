#include <gtest/gtest.h>

#include "../src/crypto/hash_wrapper.hpp"
#include "../src/crypto/merkle_tree.hpp"
#include "../src/crypto/utils.hpp"

TEST(MerkleRootTest, SHA256MerkleRoot1Tx){
    // block VRSCTEST:
    // 00000000699b0d12ac2ed950ecae5ef9fe9aadaab23c37406906913f00744716
    MerkleTree mt(HashWrapper::SHA256d);
    mt.AddTx(
        "0400008085202f89010000000000000000000000000000000000000000000000000000"
        "000000000000ffffffff05035d4f0100ffffffff02008c864700000000232102ebcebb"
        "820c89ad0c595b7bfe4bad569ee650c256d453af09f29fcd3f56126f98ac0000000000"
        "000000501a040300010114a23f82866c21819f55a1668ba7b9932e6d326b1ecc320403"
        "14010114a23f82866c21819f55a1668ba7b9932e6d326b1e1701a6ef9ea235635e3281"
        "24ff3429db9f9e91b64e2d00017561bbe261000000000000000000000000000000");

    std::string root = mt.CalcRoot();
    std::string reversed = ReverseHex(root);

    ASSERT_EQ(
        reversed,
        "c1c4cbfd27f62e12c143be66f2568dc3078f43a25feaee7b3d74a9d82f4c21fc");
}
TEST(MerkleRootTest, SHA256MerkleRoot2Tx)
{
    // block VRSCTEST:
    // 00000000699b0d12ac2ed950ecae5ef9fe9aadaab23c37406906913f00744716
    MerkleTree mt(HashWrapper::SHA256d);
    mt.AddTx(
        "0400008085202f89010000000000000000000000000000000000000000000000000000"
        "000000000000ffffffff05035d4f0100ffffffff02008c864700000000232102ebcebb"
        "820c89ad0c595b7bfe4bad569ee650c256d453af09f29fcd3f56126f98ac0000000000"
        "000000501a040300010114a23f82866c21819f55a1668ba7b9932e6d326b1ecc320403"
        "14010114a23f82866c21819f55a1668ba7b9932e6d326b1e1701a6ef9ea235635e3281"
        "24ff3429db9f9e91b64e2d00017561bbe261000000000000000000000000000000");

    mt.AddTx(
        "0400008085202f8901dcbb3209f1525920703976219368bf14247b24a62148a58cb3"
        "9e88500e82a5fc00000000694c67010101012102d85f078815b7a52faa92639c3691"
        "d2a640e26c4e06de54dd1490f0e93bcc11c340598acdd536cbfd6a31202b298268e5"
        "3af65fa2d5326b8a1103af1cc74ee3f07e790b8d06d3d5aa1f9f8bdf71fa286d4583"
        "bcb4e79454fb95daefcb53f808f929ffffffff030000000000000000fd3b04270403"
        "0001012102d85f078815b7a52faa92639c3691d2a640e26c4e06de54dd1490f0e93b"
        "cc11c3cc4d0e0404030501012102d85f078815b7a52faa92639c3691d2a640e26c4e"
        "06de54dd1490f0e93bcc11c34de40301812c04148f3ad77cc9e43a2a56f77901a707"
        "86da8e7b2b102e44280c54b767b5970865511404c0f751974bb9010030002e44280c"
        "54b767b5970865511404c0f751974bb901a6ef9ea235635e328124ff3429db9f9e91"
        "b64e2d01000000000100e1f50500000000000081a283f2c9bf000000000000000000"
        "00000000000000000000000000000000000000000000000001000000000000000001"
        "00000000000000000100000000000000000100e1f505000000000100000000000000"
        "0001000000000000000001000000000100000000000000003fa7000031993b45c3f9"
        "3ea43090b332c7739418d5c040595a153070c32672d0ae07b45e010000003972da9a"
        "060a7ceca5e3edaf09ac3fea5ff1c4f1802c39f03bdc7faff98fae3f464f0100022c"
        "b2a96d4246ae4b36b4ba2103e15c62624123ee010031002cb2a96d4246ae4b36b4ba"
        "2103e15c62624123ee02a6ef9ea235635e328124ff3429db9f9e91b64e2d2e44280c"
        "54b767b5970865511404c0f751974bb90280f0fa0280f0fa020253d9e8530a000000"
        "473e9b0a2198000084e886b69f000085d8d9d5c35900000000000000000000000000"
        "000000000000000000000000000000000000000200000000000000003b274cb43900"
        "0000020000000000000000000000000000000002171aec0300000000000000000000"
        "00000251d14c0200000000e1cbddca2100000002d3294c02000000001c8712ce2100"
        "0000020000000000000000b0536307000000000280f0fa0280f0fa02020000000000"
        "000000b053630700000000a6ef9ea235635e328124ff3429db9f9e91b64e2d010010"
        "00a6ef9ea235635e328124ff3429db9f9e91b64e2d00000000000000000000000000"
        "00000000000000000000000000000000000000000000000000000000000000000002"
        "2e44280c54b767b5970865511404c0f751974bb9010001002e44280c54b767b59708"
        "65511404c0f751974bb93fa7000037fc9cd84b39d757bd5dc15c52fe93d5acf77754"
        "4c03f5a7ee19aa083ddfa8a2b12bac4515517a5826c09c68881ecc56ec67fcc3f460"
        "2e6fc528f6f979194a2f14c8b8af031d000000000000000000000d1daf5956c6887a"
        "0000000000000000a6ef9ea235635e328124ff3429db9f9e91b64e2d01000100a6ef"
        "9ea235635e328124ff3429db9f9e91b64e2d484f0100c351b56a182db5770dcad5b1"
        "4c7831bfe2441f463c4540d3c8d04cfd94d08604509d72a5adcbc8e1babf0e0695f0"
        "ca8e4f84f62f40fadaf66bc0ae4500000000ed5901ebb4ca00000000000000000000"
        "4de029ffe8ab9a3c040000000000000001153230372e3135342e3235352e3138363a"
        "32303031310000000000000000000000000000000000000000750000000000000000"
        "fd4b012704030001012103e1894e9d487125be5a8c6657a8ce01bc81ba7816d698db"
        "fcfb0483754eb5a2d9cc4d1e0104030301012103e1894e9d487125be5a8c6657a8ce"
        "01bc81ba7816d698dbfcfb0483754eb5a2d94cf501012e44280c54b767b597086551"
        "1404c0f751974bb9b0dda303607d4d812ec2e718696bc2391d56f16ef99504a36ca4"
        "57c39a14e60f01000000000238402798fde0afcc5ed47ae15aac5b6fac4d047c014e"
        "a7000001411fc44428e27466796f9b15d451a6703f148726a4bbc5023b7f6fc692bc"
        "f3ef3dd65820e4779550fe488ae0f1c4a422b070421e2486157ebb31e881ce63c0f2"
        "56868f3ad77cc9e43a2a56f77901a70786da8e7b2b10014ea7000001411f8ee249e3"
        "da228f346b9e5ca62ec5f1bd20c40c5669a69d41e43f1b5a4931fc897c6244c29d85"
        "45245419f936f84de5330ab7ac2714a9bece223e9d79f206f0910075000000000000"
        "0000942704030001012102e3154f8122ff442fbca3ff8ff4d4fb2d9285fd9f4d841d"
        "58fb8d6b7acefed60fcc4c6804030601012102e3154f8122ff442fbca3ff8ff4d4fb"
        "2d9285fd9f4d841d58fb8d6b7acefed60f4001812e44280c54b767b5970865511404"
        "c0f751974bb900000000000000000000000000000000000000000000000000000000"
        "00000000000000000001010000007500000000704f0100000000000000000000000"
        "0");
    std::string root = mt.CalcRoot();
    std::string reversed = ReverseHex(root);
    ASSERT_EQ(
        reversed,
        "ef06909d20b41dee1a4e66a99a62d674104fc2590fd3c434e7d8ff5d2069cefa");
}